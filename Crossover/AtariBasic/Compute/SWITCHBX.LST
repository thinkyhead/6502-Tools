; AtariBASIC
;
; SWITCHBX.LST
;
; Switchbox by Todd Heimarck
; Atari version by Kevin Mykytyn
; Compute! Magazine Issue 070
;

100 O.#1,4,0,"K:":SCR=PEEK(88)+256*PEEK(89):POKE82,0:POKE752,0
120 DIM SW(4,7),SX(4,7),SP$(6),LB(32,4),AR$(6),PT(4,16),SC(1,8),P1$(20),P2$(20)
125 DIM M$(20),T$(20),Y$(10),R$(10),L$(10),A$(5)
127 F.A=0TO1:F.B=0TO8:SC(A,B)=0:N.B:N.A
130 SP$(1,3)="":SP$(4,6)="":AR$(1,3)="<  ":AR$(4,6)="  >":QR=1
140 SE.4,3,2:SE.2,0,8:SE.1,0,0
150 F.J=1TO4:READQ:PT(J,0)=Q:.Name and Goal
160 F.K=1TO8:READL:PT(J,K+8)=L:PT(J,9-K)=L:N.K:N.J:.Points
170 D.10
180 D.2,2,2,2,2,2,2,2
190 D.40
200 D.1,2,3,5,8,13,21,34
210 D.20
220 D.2,3,4,5,6,7,8,9
230 D.80
240 D.1,4,9,16,25,36,49,64

;
; Get player names
;

250 ?"":?"PLAYER 1 ";:I.P1$
260 ?"PLAYER 2 ";:I.P2$:IFLEN(P1$)>5THENP1$=P1$(1,5)
264 IFLEN(P2$)>5THENP2$=P2$(1,5)
266 ?:?P1$;" VS ";P2$
270 ?"IS THIS CORRECT?":GET#1,A:IFCHR$(A)<>"Y"THEN250


280 POKE752,1:GOS.450:GOS.610:.Setup

;
; Game Main Loop
;

290 F.RR=1TO4:TX=SCR+48+40*RR:POKETX,96:POKETX+22,96
300 GOS.560:.Put scores at bottom

;
; Loop for a round
;

310 QR=1-QR:TY=QR*20:TX=28-TY:CX=TX:CY=0
320 M$=STR$(PT(RR,0)):M$(3,3)=" "
330 GOS.1180:TX=8+TY:CX=TX:CY=0:M$=AR$(QR*3+1,QR*3+3):GOS.1180
340 GOS.770:IF SC(1-QR,RR)>=PT(RR,0)THEN360:.End of round
350 G.310

;
; End of a round
;

360 F.J=0TO1:F.K=5TO8:SC(J,K)=0:N.J:N.J
370 F.J=0TO1:F.K=1TO4:GL=PT(K,0):AC=SC(J,K):SC(J,5)=SC(J,5)+AC
380 SC(J,6)=SC(J,6)+(AC>=GL)*GL:SC(J,7)=SC(J,7)+(SC(J,K)-SC(1-J,K)):N.K:N.J
390 F.J=0TO1:F.K=6TO7:SC(J,K)=SC(J,K)+SC(J,5):N.K:N.J
400 F.J=0TO1:F.K=5TO7:SC(J,8)=SC(J,8)+SC(J,K):N.K:N.J
410 F.J=0TO1:F.K=5TO8:Y$=STR$(SC(J,K)):L=LEN(Y$):TX=6+J*31-L
420 TY=3+K:CX=TX-(TX<20):CY=TY:M$=Y$:GOS.1180:N.K:N.J
430 N.RR:.End of main loop

;
; Wait for key to restart
;

440 GET#1,TK:RUN

;
; Set up the playfield
;

450 ?"";:?"           ";:F.J=1TO7:?"";:N.J:?"":LL=7
460 F.J=0TO4:TX=9-2*J:TY=1+J*4:R$=" "
470 F.K=1TO2:CX=TX:CY=TY+K-1:M$="":GOS.1180
480 ?"   ";:GOS.550:?"":N.K
490 CX=TX:CY=TY+K-1:M$="":GOS.1180
500 ?"  ";:GOS.550:?"":CX=TX:CY=TY+K:M$="":GOS.1180
510 LL=LL+2:?"";:GOS.550:?"";:N.J
520 ?:?" ";:GOS.550:?""
530 R$="":LL=LL+1:?" ";:GOS.550:?""
540 RET.


550 F.L=1TOLL:?R$;:N.L:RET.


560 F.J=1TO16:K=PT(RR,J):JJ=2+J*2
570 IFK>9THENL=INT(K/10):T$=STR$(L):L$=T$(1,1):G.590
580 L$=CHR$(32)
590 CX=JJ:CY=22:M$=L$:GOS.1180:CX=JJ:CY=23:T$=STR$(K):M$=T$(LEN(T$),LEN(T$)):GOS.1180
600 N.J:RET.

;
; Set up for a new game
;

610 F.J=0TO4:SY=4+J*4:F.K=0TOJ+3:SX=12-J*2+K*4
620 CX=SX+1:CY=SY-1:M$=" ":GOS.1180
630 M$=" ":CX=SX+1:CY=SY-1:GOS.1180:WP=INT(RND(1)*2)
640 SW(J,K)=WP:SX(J,K)=0:GOS.760
650 N.K:N.J
660 F.J=1TO8:POKESCR+50+J*2,16+J:N.J
670 F.J=0TO1:BX=J*31:CX=BX:CY=0:M$="":GOS.1180
680 ?"";
690 F.K=1TO5:CX=BX:CY=K:M$="":GOS.1180:?"      ";:N.K
700 CX=BX:CY=K:M$="":GOS.1180
710 ?"";
720 N.J:F.TK=1TOLEN(P1$):P1$(TK,TK)=CHR$(ASC(P1$(TK,TK))+128):N.TK
725 F.TK=1TOLEN(P2$):P2$(TK,TK)=CHR$(ASC(P2$(TK,TK))+128):N.TK
730 CX=3-(LEN(P1$)=5):CY=0:M$=P1$:GOS.1180
740 CX=34-(LEN(P2$)=5):CY=0:M$=P2$:GOS.1180
750 RET.


760 CX=SX:CY=SY:M$=SP$(WP*3+1,WP*3+3):GOS.1180:RET.


770 F.J=0TO32:LB(J,0)=0:N.J:NB=1
780 GET#1,A:A$=CHR$(A)
790 IFA$="-"THENRET.
800 IFA$="+"THENA$=STR$(INT(RND(1)*8+1))
805 IFA$<"1"ORA$>"8"THEN780
810 A=VAL(A$)
820 LB(0,0)=1:F.J=1TO3:LB(0,J)=0:N.J:LB(0,4)=10+A*2
830 EX=1:EV=0
840 F.J=0TO32:IFLB(J,0)THENEX=0:GOS.870
850 N.J:SO.1,0,0,0:SO.3,0,0,0:SO.2,100,4,EV:EV=EV-(EV>0):IFEX THENRET.
860 G.830


870 DY=LB(J,0):DX=LB(J,1):LY=LB(J,2):NY=LB(J,3):NX=LB(J,4)
880 SM=SCR+40+NX+LY*160+NY*40:IF(LY+NY)THENPOKESM,0
890 LB(J,3)=(NY+1)-4*(INT((NY+1)/4)):ONNY+1GOTO900,920,960,970

900 IFLY>4THENLB(J,0)=0:G.1030:.Scoring routine
910 POKESM+40,84:ONINT(RND(1)*3+1)GOTO1080,1090,1100

920 VX=0:GOS.1020:IFSX(WY,WX)=0OR(SW(WY,WX)=SD)=0THEN940
930 VX=1-2*SD:LB(J,1)=VX:LB(J,3)=NY+1:LB(J,4)=NX+VX:POKESM+40+VX,84:G.1120

940 IFSW(WY,WX)=SD THENLB(J,0)=0:SX(WY,WX)=1:POKESM+40,84:G.1110
950 LB(J,3)=NY+1:POKESM+40,84:ONINT(RND(1)*3+1)GOTO1080,1090,1100

960 LB(J,1)=0:LB(J,4)=NX+DX:POKESM+40+DX,84:G.1130

970 LB(J,2)=LY+1:POKESM+40,84:GOS.1020:SW(WY,WX)=1-SW(WY,WX)
980 IF SX(WY,WX)=0THEN1010
990 LB(NB,0)=1:LB(NB,1)=0:LB(NB,2)=LY:LB(NB,3)=0:LB(NB,4)=NX+2-SD*4:NB=NB+1
1000 SX(WY,WX)=0:POKESM-40+2-SD*4,0:GOS.1140
1010 SX=12-WY*2+WX*4:SY=4+WY*4:WP=SW(WY,WX):GOS.760:G.1120

1020 WY=LY:JX=(NX/2)+LY-6:WX=INT(JX/2):SD=JX-2*(INT(JX/2)):RET.

1030 SF=PT(RR,NX/2-1)
1040 SG=SC(QR,RR)+SF
1050 TX=5+31*QR-(SG>9)-(SG>99)-(SG>999)
1060 TY=1+RR:A$=STR$(SG)
1070 CX=TX:CY=TY:M$=A$:GOS.1180:SC(QR,RR)=SG:G.1150

;
; Sound Effects
;
1080 SO.1,60,10,10:RET.
1090 SO.1,121,10,10:RET.
1100 SO.1,81,10,10:RET.
1110 F.A=10TO30:SO.1,A,12,10:N.A:SO.1,0,0,0:RET.
1120 RET.
1130 F.A=40TO20STEP-1:SO.1,A,12,10:N.A:SO.1,0,0,0:RET.
1140 SO.2,100,4,15:EV=15:RET.
1150 SO.1,121,10,10:SO.3,81,10,10
1160 RET.

;
; Print M$ at Position CX,CY
;
1170 .CHAR COMMAND
1180 POS.CX,CY:?M$;:RET.

2000 GOS.1:T5=T:V=N0:F.I=N0 TO100000:V=V+N1:N.I:GOS.1:T5=T-T5
2001 GOS.1:T6=T:V=N0:F.I=N0 TO100000:V=V+1:N.I:GOS.1:T6=T-T6
2002 RET.
